# J

数据范围较小，往状压dp方向靠拢。

我们可以对限制条件中出现的 M 种数分类

一类出现在正好一种颜色卡片种，一类出现在两种颜色卡片中

我们枚举这正好出现在一种颜色卡片中的两个集合 $s_1,s_2$

有隔板法
$$
\sum_{s_1 \cap s_2=0} \binom{n_1-1+(m-M)}{|s_1|+(M-|s_1|-|s_2|)-1+(m-M)}\binom{n_2-1+(m-M)}{|s_2|+(M-|s_1|-|s_2|)-1+(m-M)}\\
=\sum_{s_1}\binom{n_2-1+m-M}{n-|s_1|-1}\sum_{s_1\cap s_2=0} \binom{n_1-1+m-M}{n-|s_2|-1}
$$

我们可以通过高位前缀和处理等式右边的部分。

然后再预处理一下组合数即可。


