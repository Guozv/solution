# CF1515E

发现最后一定是手动点亮一些连续段，中间隔一个被动亮的

直接 dp[i][j] 表示前i 个灯有 j 个连续段的方案数 然后 对于段内方案数是 $\sum_{i=1}^{n-1}\binom{n}{i} =2^{n-1}$

然后这段新的电脑的排列顺序又可以跟前面的段内交换方案数 $\binom{i-j+1}{n}$ 

# P3643

简单暴力的思路

对暴力 dp[i][j] 表示前 i 个学校 j 为最大值的方案数。

$$dp[i][j]=dp[i-1][j]+[a_i\le j \le b_i]\sum_{k=1}^{j-1}dp[i-1][k]$$

容易想到多项式维护这个式子，后面区间中的求和可以使用离散微积分做到快速求表达式。

最后式子是分段函数的形式，注意细节，维护一下常数项即可


# AGC30 - D - Inversion Sum

喵喵题。

直接计数是困难的，这里可以转化为期望。

对于每次操作有二分之一概率执行。

我们定义 F[i][j] 表示 $a_i>a_j$ 的概率，每次对于 $x,y$ 可以发现 $F[i][x],F[i][y]$ 可能会交换， $F[x][i],F[y][i]$ 可能会交换 $F[x][y],F[y][x]$ 同理，然后维护这个数组就行了，复杂度 $O(n^2+nq)$ 。

# AT_codefestival_2016_final_f_Road_of_the_King

明显的dp，考虑如何设计状态。

要求图强联通，则每个点与 1 都要相互可到达，我们设计状态表示走了 i 步，路过了 j 个点 k 个点 与 1 强联通

只要我们重新走回到与 1 强联通的点，路过的所有点都会变成强联通。

以此可以很快写出转移方程。

# P9823 [ICPC 2020 Shanghai R] The Journey of Geor Autumn

考虑 1 的位置

设 1 在位置 $x,x\ le k$ 

则有前 x 个数的位置是可以随便放的。

然后 $[x+1,x+k]$ 区间里的数也是可以随便放的

所以这里相当于一个子问题，我们还是需要吧最小值放到前 k 个位置。

所以有 

$$
f_n=\sum_{x=1}^{\min(n,k)}(x-1)!\binom{n-1}{x-1}f_{n-x}\\
=\sum_{x=1}^{\min(n,k)}\frac{(n-1)!}{(n-x)!}f_{n-x}
$$

# AT_arc178_d [ARC178D] Delete Range Mex

考虑反过来加数。

我们从小到大加数，一个数只能被加到所有小于等于他的数的两边。

对于给出的 $n$ 个数，有 $n+1$ 个插入位置。

然后对于一个数 $x$，如果已经出现过

$F[x-1][l][r]\to F[x][\min(l,pos_x)][\max(pos_x+1,r)]$

否则枚举出现位置，前缀和优化一下就行。