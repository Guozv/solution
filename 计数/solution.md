# CF1515E

发现最后一定是手动点亮一些连续段，中间隔一个被动亮的

直接 dp[i][j] 表示前i 个灯有 j 个连续段的方案数 然后 对于段内方案数是 $\sum_{i=1}^{n-1}\binom{n}{i} =2^{n-1}$

然后这段新的电脑的排列顺序又可以跟前面的段内交换方案数 $\binom{i-j+1}{n}$ 

# P3643

简单暴力的思路

对暴力 dp[i][j] 表示前 i 个学校 j 为最大值的方案数。

$$dp[i][j]=dp[i-1][j]+[a_i\le j \le b_i]\sum_{k=1}^{j-1}dp[i-1][k]$$

容易想到多项式维护这个式子，后面区间中的求和可以使用离散微积分做到快速求表达式。

最后式子是分段函数的形式，注意细节，维护一下常数项即可


# AGC30 - D - Inversion Sum

喵喵题。

直接计数是困难的，这里可以转化为期望。

对于每次操作有二分之一概率执行。

我们定义 F[i][j] 表示 $a_i>a_j$ 的概率，每次对于 $x,y$ 可以发现 $F[i][x],F[i][y]$ 可能会交换， $F[x][i],F[y][i]$ 可能会交换 $F[x][y],F[y][x]$ 同理，然后维护这个数组就行了，复杂度 $O(n^2+nq)$ 。

